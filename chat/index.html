<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HH Chatroom</title>
    <link rel="icon" href="favicon.jpg">
    <link rel="stylesheet" href="chat_style.css">
</head>
<body>
    <div class="chat-window">
        <div class="chat-header">
            <h2>Global Chat</h2>
            <!-- <div class="UName">YOU</div> -->
        </div>

        <div id="chat-display">            
        </div>

            <div class="chat-input-area">
                <input type="text" id="message-input" placeholder="Type message..." autocomplete="off">
                <button id="send-btn">Send</button>
            </div>
    </div>






<script type="module">
// Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getDatabase, push, ref, onChildAdded } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAhka9YxFxjmQcULf3AZdoH5Z3GANMDX28",
    databaseURL: "https://chat-b28af-default-rtdb.firebaseio.com",
    authDomain: "chat-b28af.firebaseapp.com",
    projectId: "chat-b28af",
    storageBucket: "chat-b28af.firebasestorage.app",
    messagingSenderId: "542996093221",
    appId: "1:542996093221:web:7dc104ba085ce0c6ff62cc"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

        const chatDisplay = document.getElementById("chat-display");
        const messageInput = document.getElementById("message-input");
        const sendBtn = document.getElementById("send-btn");
        const headerName = document.querySelector(".chat-header");

        const username = localStorage.getItem("chatName");
         if(!username){
            window.location.href = "CHATROOM/index.html";
        }
        const hdrName = document.createElement("div");
        hdrName.innerHTML = `<div class="UName">${username}</div>`;
        headerName.appendChild(hdrName)
        const messageRef = ref(database, 'messages/');
        onChildAdded(messageRef, (snapshot) =>{
                const data = snapshot.val();

                const msgDiv = document.createElement("div");
                msgDiv.classList.add("msg");

                const displayName = data.name === username ? "You" : data.name

                if(data.name === username){
                    msgDiv.classList.add("sent");
                }else{
                    msgDiv.classList.add("received")
                }
                msgDiv.innerHTML = `<span class="msg-name">${displayName}</span>${data.message}`;
                chatDisplay.appendChild(msgDiv);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
        })
        function sendMessage(){
            const text = messageInput.value.trim();
            if(text !== ""){
                
                // const msgDiv = document.createElement("div");
                // msgDiv.classList.add('msg', 'sent');
                // msgDiv.innerHTML = `<span class="msg-name">${username}</span>${text}`;
                // chatDisplay.appendChild(msgDiv);
                messageInput.value = "";
                // chatDisplay.scrollTop = chatDisplay.scrollHeight;

                // A post entry.
               push(ref(database, 'messages/'),{
                   name: username,
                   message: text, 
                   timestamp: Date.now()
               });
            }
        }

        sendBtn.addEventListener("click", sendMessage);
        messageInput.addEventListener("keypress", (e) =>{
            if(e.key === "Enter") sendMessage();
        })
</script>
</body>
</html>